# OpenCode iOS Client â€” Product Requirements Document

> Version 0.1 Â· Draft Â· Feb 2026

## 1. äº§å“å®šä½

OpenCode iOS Client æ˜¯ä¸€ä¸ªé¢å‘ OpenCode æœåŠ¡ç«¯çš„åŸç”Ÿ iOS è¿œç¨‹æ§åˆ¶åº”ç”¨ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ AI ç¼–ç¨‹å·¥å…·ï¼Œè€Œæ˜¯è¿è¡Œåœ¨ Mac/Server ä¸Šçš„ OpenCode å®ä¾‹çš„**ç§»åŠ¨ç«¯å»¶ä¼¸**â€”â€”è®©ç”¨æˆ·å¯ä»¥åœ¨æ²™å‘ä¸Šã€é€šå‹¤ä¸­æˆ–ä»»ä½•è¿œç¦»ç”µè„‘çš„åœºæ™¯ä¸‹ï¼Œå‘é€æŒ‡ä»¤ã€ç›‘æ§ AI å·¥ä½œè¿›åº¦ã€æµè§ˆä»£ç å˜æ›´ã€åˆ‡æ¢æ¨¡å‹ã€‚

æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼š**è½»é‡ã€å¿«é€Ÿã€åªè¯»ä¸ºä¸»ã€äº¤äº’ä¸ºè¾…**ã€‚æ‰€æœ‰ç¹é‡çš„é…ç½®ï¼ˆProvider å¯†é’¥ã€MCP æœåŠ¡ã€workspace è®¾ç½®ï¼‰éƒ½åœ¨ç”µè„‘ç«¯å®Œæˆï¼ŒiOS ç«¯åªåšå¿…è¦çš„äº¤äº’å’Œæ¶ˆè´¹ã€‚

### 1.1 å®ƒä¸æ˜¯ä»€ä¹ˆ

è¿™ä¸ª App ä¸è¯•å›¾åšä»¥ä¸‹äº‹æƒ…ï¼šåœ¨æ‰‹æœºä¸Šç¼–è¾‘ä»£ç ã€åœ¨æ‰‹æœºä¸Šè¿è¡Œ OpenCode serverã€æ›¿ä»£å®Œæ•´çš„ Web UIã€‚å®ƒçš„ä»·å€¼åœ¨äº"éšæ—¶æå‡ºæ‰‹æœºçœ‹ä¸€çœ¼ AI å¹²åˆ°å“ªäº†ï¼Œå¿…è¦æ—¶è¸¢å®ƒä¸€è„šè®©å®ƒæ¢ä¸ªæ–¹å‘"è¿™ç§åœºæ™¯ã€‚

## 2. ç›®æ ‡ç”¨æˆ·ä¸ä½¿ç”¨åœºæ™¯

ç›®æ ‡ç”¨æˆ·æ˜¯æ—¥å¸¸ä½¿ç”¨ OpenCode çš„å¼€å‘è€…ï¼ˆåˆæœŸå°±æ˜¯ä½œè€…è‡ªå·±ï¼‰ï¼Œå…¸å‹åœºæ™¯åŒ…æ‹¬ï¼š

**åœºæ™¯ A â€” è¿œç¨‹ç›‘æ§**ï¼šåœ¨ç”µè„‘ä¸Šå¯åŠ¨äº†ä¸€ä¸ªè€—æ—¶çš„é‡æ„ä»»åŠ¡ï¼Œç¦»å¼€å·¥ä½å»å€’å’–å•¡ã€‚æå‡ºæ‰‹æœºï¼Œçœ‹åˆ° AI æ­£åœ¨å¤„ç†ç¬¬ 3 ä¸ªæ–‡ä»¶ï¼Œå·²ç»ä¿®æ”¹äº† 12 ä¸ªæ–‡ä»¶ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚

**åœºæ™¯ B â€” å¿«é€Ÿçº å**ï¼šæ‰‹æœºä¸Šçœ‹åˆ° AI èµ°åäº†ï¼Œæ­£åœ¨ç”¨é”™è¯¯çš„æ–¹æ³•å®ç°æŸä¸ªåŠŸèƒ½ã€‚å¿«é€Ÿå‘ä¸€æ¡æ¶ˆæ¯ï¼š"åœï¼Œä¸è¦ç”¨ç»§æ‰¿ï¼Œæ”¹ç”¨ç»„åˆæ¨¡å¼"ï¼Œç„¶åæ”¾å›å£è¢‹ã€‚

**åœºæ™¯ C â€” æ¨¡å‹ A/B æµ‹è¯•**ï¼šæƒ³æ¯”è¾ƒ Claude Opus å’Œ Gemini 2.5 Pro å¯¹åŒä¸€ä¸ªä»»åŠ¡çš„è¡¨ç°ã€‚åœ¨æ‰‹æœºä¸Šä¸€é”®åˆ‡åˆ°å¦ä¸€ä¸ªæ¨¡å‹ï¼Œå‘é€ç›¸åŒçš„æŒ‡ä»¤ï¼Œè§‚å¯Ÿå·®å¼‚ã€‚

**åœºæ™¯ D â€” æ–‡æ¡£å®¡æŸ¥**ï¼šAI å®Œæˆäº†ä¸€è½®ä¿®æ”¹ï¼Œåœ¨æ‰‹æœºä¸Šæµè§ˆ Markdown æ–‡æ¡£çš„ diffï¼Œä»¥ Preview æ¨¡å¼ä¸ºä¸»æŸ¥çœ‹å˜æ›´ï¼Œç¡®è®¤æ–‡æ¡£æ”¹åŠ¨åˆç†åè®© AI ç»§ç»­ä¸‹ä¸€æ­¥ã€‚ä»£ç å®¡æŸ¥ä¸ºè¾…â€”â€”AI èƒ½åŠ›å·²è¶³å¤Ÿå†™å‡ºå¥½ä»£ç ï¼Œä¸»è¦éœ€è¦çš„æ˜¯æ–‡æ¡£å®¡æŸ¥ã€‚

## 3. æŠ€æœ¯æ¶æ„

### 3.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         HTTP REST + SSE         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                  â”‚
â”‚  iOS Client  â”‚    å±€åŸŸç½‘ / Tailscale / etc.     â”‚  OpenCode Server â”‚
â”‚  (SwiftUI)   â”‚                                  â”‚  (Mac/Linux)     â”‚
â”‚              â”‚                                  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     çº¯å±•ç¤º + æŒ‡ä»¤å‘é€                              æ–‡ä»¶ç³»ç»Ÿ + AI è®¡ç®—
```

iOS ç«¯æ˜¯çº¯ç²¹çš„ API æ¶ˆè´¹è€…ã€‚ä¸éœ€è¦ä»»ä½•æœ¬åœ° AI æ¨ç†ã€æ–‡ä»¶ç³»ç»Ÿè®¿é—®æˆ– shell æ‰§è¡Œèƒ½åŠ›ã€‚æ‰€æœ‰æ•°æ®é€šè¿‡ OpenCode çš„ HTTP API è·å–ï¼Œå®æ—¶æ›´æ–°é€šè¿‡ SSEï¼ˆServer-Sent Eventsï¼‰æ¨é€ã€‚

### 3.2 æŠ€æœ¯é€‰å‹

| å±‚é¢ | é€‰æ‹© | ç†ç”± |
|------|------|------|
| UI æ¡†æ¶ | SwiftUI | åŸç”Ÿä½“éªŒã€æµç•…åŠ¨ç”»ã€iOS ç‰¹æ€§åˆ©ç”¨æœ€å……åˆ† |
| ç½‘ç»œå±‚ | URLSession + åŸç”Ÿ SSE | æ— éœ€å¼•å…¥ç¬¬ä¸‰æ–¹ HTTP åº“ï¼ŒSSE åè®®æœ¬èº«å¾ˆç®€å• |
| çŠ¶æ€ç®¡ç† | Swift Observation (@Observable) | iOS 17+ åŸç”Ÿæ–¹æ¡ˆï¼Œé…åˆ SwiftUI æœ€ç®€æ´ |
| ä»£ç é«˜äº® | TreeSitter (via swift binding) æˆ– Splash | ç¦»çº¿è¯­æ³•é«˜äº® |
| Markdown æ¸²æŸ“ | åŸç”Ÿ TextKit / MarkdownUI | æ–‡æ¡£é¢„è§ˆã€æ”¯æŒä»£ç å— |
| Diff æ¸²æŸ“ | è‡ªå»ºç»„ä»¶ (åŸºäºæœåŠ¡ç«¯è¿”å›çš„ before/after) | æœåŠ¡ç«¯å·²ç»åšäº† diff è®¡ç®—ï¼Œå®¢æˆ·ç«¯åªéœ€æ¸²æŸ“ï¼›æ–‡æ¡£ diff éœ€é«˜äº® changes |
| æœ€ä½ç‰ˆæœ¬ | iOS 17.0 | ä½¿ç”¨ Observation æ¡†æ¶ï¼Œæ”¾å¼ƒ iOS 16 |
| æŒä¹…åŒ– | UserDefaults + Keychain | åªéœ€å­˜è¿æ¥ä¿¡æ¯å’Œæ¨¡å‹é¢„è®¾ï¼Œæ— éœ€æœ¬åœ°æ•°æ®åº“ |

### 3.3 ä¸ OpenCode Server çš„é€šä¿¡

é€šä¿¡åŸºäºä¸¤ä¸ªé€šé“ï¼š

**REST API** â€” ç”¨äºæ‰€æœ‰ä¸»åŠ¨æ“ä½œï¼ˆå‘æ¶ˆæ¯ã€è·å–æ–‡ä»¶åˆ—è¡¨ã€åˆ‡æ¢é…ç½®ç­‰ï¼‰ã€‚åŸºç¡€è·¯å¾„ç”±ç”¨æˆ·åœ¨ Settings ä¸­é…ç½®çš„ `http://<ip>:<port>` å†³å®šã€‚

**SSE (Server-Sent Events)** â€” ç”¨äºå®æ—¶æ›´æ–°ã€‚è¿æ¥åˆ° `GET /global/event` ç«¯ç‚¹ï¼Œæ¥æ”¶æ‰€æœ‰äº‹ä»¶æ¨é€ã€‚äº‹ä»¶æ ¼å¼ä¸º `{ directory, payload: { type, properties } }`ã€‚

SSE è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†æ˜¯ä¸€ä¸ªå…³é”®æŠ€æœ¯ç‚¹ï¼š
- App è¿›å…¥å‰å°æ—¶å»ºç«‹/æ¢å¤ SSE è¿æ¥
- App è¿›å…¥åå°æ—¶æ–­å¼€ SSE è¿æ¥ï¼ˆiOS ä¸é€‚åˆç»´æŒé•¿è¿æ¥ï¼‰
- ä»åå°æ¢å¤æ—¶ï¼Œå…ˆé€šè¿‡ REST API æ‹‰å–å½“å‰çŠ¶æ€åšä¸€æ¬¡å…¨é‡åŒæ­¥ï¼Œå†é‡æ–°å»ºç«‹ SSE

### 3.4 è®¤è¯

OpenCode Server æ”¯æŒå¯é€‰çš„ Basic Authï¼ˆ`OPENCODE_SERVER_PASSWORD`ï¼‰ã€‚iOS ç«¯åœ¨ Settings ä¸­æä¾›ç”¨æˆ·å/å¯†ç å­—æ®µï¼Œå­˜å…¥ Keychainã€‚æ¯ä¸ª REST è¯·æ±‚å’Œ SSE è¿æ¥éƒ½å¸¦ä¸Š Basic Auth headerã€‚

## 4. åŠŸèƒ½è§„æ ¼

### 4.1 Tab ç»“æ„

App é‡‡ç”¨åº•éƒ¨ Tab Barï¼Œä¸‰ä¸ª Tabï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚          (Tab Content Area)         â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ğŸ’¬ Chat  â”‚  ğŸ“ Files  â”‚  âš™ Settings â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Chat Tabï¼ˆä¸»äº¤äº’ç•Œé¢ï¼‰

è¿™æ˜¯ App çš„æ ¸å¿ƒã€‚é¡¶éƒ¨æ˜¯æ¨¡å‹åˆ‡æ¢æ¡ï¼Œä¸­é—´æ˜¯æ¶ˆæ¯æµï¼Œåº•éƒ¨æ˜¯è¾“å…¥æ¡†ã€‚

#### 4.2.1 æ¨¡å‹åˆ‡æ¢æ¡

ä½äº Chat é¡µé¢é¡¶éƒ¨ï¼Œæ¨ªå‘æ»šåŠ¨çš„ chip åˆ—è¡¨ã€‚æ¯ä¸ª chip ä»£è¡¨ä¸€ä¸ªé¢„è®¾æ¨¡å‹ï¼ˆåœ¨ Settings ä¸­é…ç½®ï¼‰ï¼Œæ ¼å¼å¦‚ "Claude Opus" / "Gemini 2.5 Pro" / "GPT-4.1"ã€‚ç‚¹å‡»åˆ‡æ¢ï¼Œä¸‹ä¸€æ¡æ¶ˆæ¯å°†ä½¿ç”¨é€‰ä¸­çš„æ¨¡å‹ã€‚å½“å‰é€‰ä¸­çš„ chip é«˜äº®æ˜¾ç¤ºã€‚

æŠ€æœ¯å®ç°ï¼šåˆ‡æ¢æ¨¡å‹ä¸éœ€è¦è°ƒç”¨ APIï¼Œåªæ˜¯æ”¹å˜æœ¬åœ°çŠ¶æ€ã€‚å‘é€æ¶ˆæ¯æ—¶åœ¨ `POST /session/:id/message` çš„ body ä¸­æºå¸¦ `model: { providerID, modelID }` å­—æ®µã€‚OpenCode çš„è®¾è®¡æœ¬èº«å°±æ”¯æŒ per-message çš„æ¨¡å‹æŒ‡å®šã€‚

#### 4.2.2 æ¶ˆæ¯æµ

å‚ç›´æ»šåŠ¨çš„æ¶ˆæ¯åˆ—è¡¨ï¼Œæ ·å¼å‚è€ƒ OpenCode Web å®¢æˆ·ç«¯ï¼š**ä¸é‡‡ç”¨å·¦å³æ°”æ³¡**ï¼Œæ‰€æœ‰æ¶ˆæ¯ç»Ÿä¸€æµå¼æ’å¸ƒï¼Œäººç±»æ¶ˆæ¯ç”¨ç°è‰²èƒŒæ™¯åŒºåˆ†ã€‚æ•´ä½“é£æ ¼ç±»ä¼¼ OpenCode çš„ç´§å‡‘å¯¹è¯æµã€‚

æ¯æ¡æ¶ˆæ¯åŒ…å«ï¼š

**ç”¨æˆ·æ¶ˆæ¯**ï¼šç°è‰²èƒŒæ™¯ï¼Œæ˜¾ç¤ºæ–‡æœ¬å†…å®¹ã€‚åº•éƒ¨å°å­—æ ‡æ³¨ä½¿ç”¨çš„æ¨¡å‹ã€‚

**AI æ¶ˆæ¯**ï¼šç™½è‰²/é€æ˜èƒŒæ™¯ï¼ŒåŒ…å«å¤šç§ Part ç±»å‹çš„æ¸²æŸ“ï¼š
- `text` â€” Markdown æ¸²æŸ“ï¼ˆæ”¯æŒä»£ç å—ã€é“¾æ¥ã€åˆ—è¡¨ç­‰ï¼‰
- `reasoning` â€” æŠ˜å é¢æ¿ï¼Œæ ‡é¢˜ "Thinking..."ï¼Œç‚¹å‡»å±•å¼€æŸ¥çœ‹æ¨ç†è¿‡ç¨‹
- `tool` â€” å·¥å…·è°ƒç”¨å¡ç‰‡ï¼Œæ˜¾ç¤ºå·¥å…·åç§°å’ŒçŠ¶æ€ï¼ˆpending â†’ running â†’ completed/errorï¼‰ã€‚**running æ—¶å±•å¼€**æ˜¾ç¤ºè¿›åº¦ï¼ˆspinnerï¼‰ï¼Œ**completed æ—¶é»˜è®¤æ”¶èµ·**ï¼Œå¯ç‚¹å‡»å±•å¼€æŸ¥çœ‹å…ƒæ•°æ®ï¼ˆå¦‚æ–‡ä»¶è·¯å¾„ã€å‘½ä»¤è¾“å‡ºï¼‰
- `step-start` / `step-finish` â€” æ¸²æŸ“ä¸ºæ­¥éª¤åˆ†éš”çº¿ï¼Œæ˜¾ç¤º token ç”¨é‡å’Œæˆæœ¬
- `patch` â€” æ–‡ä»¶å˜æ›´æ‘˜è¦å¡ç‰‡ï¼Œæ˜¾ç¤ºä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨ï¼Œç‚¹å‡»å¯è·³è½¬åˆ° Files Tab çš„ File Tree ä¸­æ‰“å¼€è¯¥æ–‡ä»¶é¢„è§ˆ
- `tool`ï¼ˆwrite/edit/apply_patch/read_file ç­‰ï¼‰â€” è‹¥ part å«æ–‡ä»¶è·¯å¾„ï¼ˆmetadata.pathã€state.input.pathã€files æ•°ç»„ã€æˆ– patchText è§£æï¼‰ï¼Œç‚¹å‡»å¯å¼¹å‡ºé€‰é¡¹ã€Œåœ¨ File Tree ä¸­æ‰“å¼€ã€ï¼Œç›´æ¥æ‰“å¼€æ–‡ä»¶é¢„è§ˆ

**æµå¼æ›´æ–°ï¼ˆSync Streamingï¼‰**ï¼šè¡Œä¸ºä¸å®˜æ–¹ Web å®¢æˆ·ç«¯å¯¹é½ã€‚SSE æ¨é€ `message.part.updated` æ—¶ï¼Œè‹¥æœ‰ `delta` å­—æ®µï¼Œå®¢æˆ·ç«¯å¢é‡è¿½åŠ åˆ°å¯¹åº” text/reasoning Partï¼Œå®ç°æ‰“å­—æœºæ•ˆæœï¼›è‹¥æ—  delta åˆ™å…¨é‡ reloadã€‚ä½¿ç”¨ `messageID` + `partID` å®šä½ Partã€‚è¯¦è§ [SYNC_STREAMING_RESEARCH.md](SYNC_STREAMING_RESEARCH.md)ã€‚**æ³¨**ï¼šTool output çš„å®æ—¶æµå¼ï¼ˆå¦‚ terminal è¾“å‡ºé€è¡Œï¼‰å½“å‰ API ä¸æ”¯æŒï¼Œoutput ä»…åœ¨ completed æ—¶ä¸€æ¬¡æ€§è¿”å›ã€‚

**Session çŠ¶æ€æŒ‡ç¤ºå™¨**ï¼šæ¶ˆæ¯æµé¡¶éƒ¨æ˜¾ç¤ºå½“å‰ session çŠ¶æ€ï¼ˆidle / busy / errorï¼‰ã€‚çŠ¶æ€æ¥æºäº `session.status` SSE äº‹ä»¶ã€‚busy æ—¶æ˜¾ç¤ºè¿›åº¦åŠ¨ç”»ã€‚

#### 4.2.3 æƒé™é€šçŸ¥

OpenCode ç»å¤§å¤šæ•°æƒ…å†µä¸‹ä¸ä¼šè¯·æ±‚ permissionï¼Œè‹¥å‡ºç° `permission.asked` äº‹ä»¶ï¼Œé€šå¸¸è¯´æ˜æœ‰å¼‚å¸¸æƒ…å†µã€‚å› æ­¤é‡‡ç”¨**æ‰‹åŠ¨æ‰¹å‡†**æ¨¡å¼ï¼š

- ç›‘å¬ SSE çš„ `permission.asked` äº‹ä»¶
- åœ¨æ¶ˆæ¯æµä¸­æ’å…¥æƒé™è¯·æ±‚å¡ç‰‡ï¼Œæ˜¾ç¤ºå¾…æ‰¹å‡†çš„æ“ä½œï¼ˆå¦‚ "æ‰§è¡Œ `rm -rf node_modules`"ï¼‰
- ç”¨æˆ·éœ€æ‰‹åŠ¨ç‚¹å‡»ã€Œæ‰¹å‡†ã€æˆ–ã€Œæ‹’ç»ã€ï¼Œè°ƒç”¨ `POST /session/:id/permissions/:permissionID` å“åº”
- ä¸æä¾›è‡ªåŠ¨æ‰¹å‡†

#### 4.2.4 è¾“å…¥æ¡†

åº•éƒ¨å›ºå®šè¾“å…¥æ¡†ï¼Œæ”¯æŒå¤šè¡Œæ–‡æœ¬ã€‚å³ä¾§å‘é€æŒ‰é’®ã€‚è¾“å…¥æ¡†ä¸Šæ–¹å¯é€‰æ˜¾ç¤ºå½“å‰é€‰ä¸­æ¨¡å‹çš„å°æ ‡ç­¾ã€‚

**æ¶ˆæ¯é˜Ÿåˆ—**ï¼šå½“ session å¤„äº busy çŠ¶æ€æ—¶ï¼Œç”¨æˆ·å‘é€çš„æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—ã€‚OpenCode Server çš„ `POST /session/:id/prompt_async` åœ¨æœåŠ¡ç«¯å·²æ”¯æŒé˜Ÿåˆ—â€”â€”busy æ—¶ä¼šå°†æ¶ˆæ¯å…¥é˜Ÿï¼Œå½“å‰è¿è¡Œç»“æŸåè‡ªåŠ¨å¤„ç†ã€‚iOS ç«¯è°ƒç”¨ `prompt_async` å³å¯ï¼Œæ— éœ€æœ¬åœ°ç»´æŠ¤é˜Ÿåˆ—ã€‚è‹¥æœªæ¥ API å˜æ›´ï¼Œå¯é€€åŒ–ä¸ºæœ¬åœ°é˜Ÿåˆ—ç»´æŠ¤ã€‚

**Enter è¡Œä¸ºè°ƒç ”ç»“è®º**ï¼šOpenCode Web å®¢æˆ·ç«¯åœ¨ç©ºè¾“å…¥æ—¶æŒ‰ Enter ä¼šè°ƒç”¨ abort ç»ˆæ­¢å½“å‰è¿è¡Œï¼›æœ‰å†…å®¹æ—¶æŒ‰ Enter å‘é€æ¶ˆæ¯ï¼ˆé€šè¿‡ promptï¼Œæ¶ˆæ¯ç”±æœåŠ¡ç«¯é˜Ÿåˆ—å¤„ç†ï¼‰ã€‚æ— ã€Œæ™ºèƒ½ steerã€æœºåˆ¶ï¼Œä»…ç»ˆæ­¢æˆ–æ’é˜Ÿã€‚iOS ç«¯å¯æä¾›æ‰‹åŠ¨ abort æŒ‰é’®ï¼Œæ— éœ€å®ç°é¢å¤– steerã€‚

é¢å¤–æ“ä½œï¼ˆé€šè¿‡è¾“å…¥æ¡†å·¦ä¾§çš„ "+" æŒ‰é’®æˆ–é•¿æŒ‰å‘é€æŒ‰é’®è§¦å‘ï¼‰ï¼š
- æ–°å»º Session
- ä¸­æ­¢å½“å‰è¿è¡Œï¼ˆè°ƒç”¨ `POST /session/:id/abort`ï¼‰
- Compact Sessionï¼ˆè°ƒç”¨ `POST /session/:id/summarize`ï¼‰

#### 4.2.5 Session ç®¡ç†

ä» Chat Tab é¡¶éƒ¨å·¦ä¾§çš„æŒ‰é’®è¿›å…¥ Session åˆ—è¡¨ï¼ˆslide-over æˆ– navigation pushï¼‰ã€‚**åˆ—å‡º workspace ä¸‹æ‰€æœ‰å·²æœ‰ Session**ï¼Œæ˜¯é‡è¦çš„åŠŸèƒ½éªŒè¯æ‰‹æ®µï¼šå¯éªŒè¯è¿æ¥æ˜¯å¦æ­£ç¡®ã€API è§£ææ˜¯å¦æ­£å¸¸ã€æ¶ˆæ¯/çŠ¶æ€èƒ½å¦æ­£ç¡®å±•ç¤ºã€‚

åˆ—è¡¨æ˜¾ç¤ºæ‰€æœ‰ Sessionï¼ŒæŒ‰æ—¶é—´å€’åºã€‚æ¯ä¸ªæ¡ç›®æ˜¾ç¤ºï¼šæ ‡é¢˜ã€åˆ›å»ºæ—¶é—´ã€æ¶ˆæ¯æ•°ã€çŠ¶æ€ï¼ˆidle/busyï¼‰ã€‚æ”¯æŒæ–°å»º Sessionã€åˆ é™¤ Sessionã€åˆ‡æ¢ Sessionã€‚

### 4.3 Files Tabï¼ˆæ–‡ä»¶æµè§ˆä¸ Diffï¼‰

#### 4.3.1 æ–‡ä»¶æ ‘

å·¦ä¾§ï¼ˆiPadï¼‰æˆ–å…¨å±ï¼ˆiPhoneï¼‰æ˜¾ç¤ºæ–‡ä»¶æ ‘ã€‚æ•°æ®æ¥æºï¼š`GET /file?path=<path>`ã€‚

æ–‡ä»¶æ ‘ä»¥é€’å½’å±•å¼€/æ”¶èµ·çš„å½¢å¼å‘ˆç°ç›®å½•ç»“æ„ã€‚æ¯ä¸ªèŠ‚ç‚¹æ˜¾ç¤ºæ–‡ä»¶/ç›®å½•åå’Œå›¾æ ‡ã€‚æœ‰ git å˜æ›´çš„æ–‡ä»¶å¸¦æœ‰é¢œè‰²æ ‡è®°ï¼ˆç»¿è‰²æ–°å¢ã€é»„è‰²ä¿®æ”¹ã€çº¢è‰²åˆ é™¤ï¼‰ï¼Œæ•°æ®æ¥æºäº `GET /file/status`ã€‚

æ”¯æŒæœç´¢æ¡†åšæ–‡ä»¶åæ¨¡ç³Šæœç´¢ï¼ˆ`GET /find/file?query=...`ï¼‰ã€‚

#### 4.3.2 æ–‡ä»¶å†…å®¹æŸ¥çœ‹

ç‚¹å‡»æ–‡ä»¶åè¿›å…¥å†…å®¹æŸ¥çœ‹é¡µé¢ã€‚æ•°æ®æ¥æºï¼š`GET /file/content?path=...`ã€‚

æ–‡æœ¬æ–‡ä»¶ï¼šå¸¦è¯­æ³•é«˜äº®çš„ä»£ç æŸ¥çœ‹å™¨ï¼Œæ˜¾ç¤ºè¡Œå·ï¼Œæ¨ªå‘å¯æ»šåŠ¨ã€‚å­—ä½“ä½¿ç”¨ç­‰å®½å­—ä½“ï¼ˆSF Mono æˆ– Menloï¼‰ï¼Œå­—å·å¯åœ¨ Settings ä¸­è°ƒæ•´ã€‚

äºŒè¿›åˆ¶æ–‡ä»¶/å›¾ç‰‡ï¼šæ˜¾ç¤ºæ–‡ä»¶ç±»å‹æç¤ºæˆ–å›¾ç‰‡é¢„è§ˆï¼ˆbase64 è§£ç ï¼‰ã€‚

#### 4.3.3 Diff æŸ¥çœ‹ä¸æ–‡æ¡£é¢„è§ˆ

**æ ¸å¿ƒå®šä½**ï¼šä»¥**æ–‡æ¡£å®¡æŸ¥**ä¸ºä¸»ã€‚Markdown æ¸²æŸ“ã€æ–‡æ¡£ diffã€Preview æ¨¡å¼æ˜¯å¿…å¤‡èƒ½åŠ›ã€‚

**Markdown å±•ç¤º**ï¼š
- ä¼˜å…ˆ **Preview æ¨¡å¼**ï¼šç”¨æˆ·ä»¥ Preview ä¸ºä¸»æŸ¥çœ‹æ–‡æ¡£ï¼Œè‹¥å®ç°éš¾åº¦å¤§ï¼Œå¯æ”¯æŒ Preview / Markdown åˆ‡æ¢
- **Changes é«˜äº®**ï¼šéœ€åœ¨ diff ä¸­é«˜äº®å˜æ›´ã€‚è‹¥åœ¨ Preview ç•Œé¢é«˜äº®æœ‰éš¾åº¦ï¼Œå¯åœ¨ Markdown ç•Œé¢é«˜äº® changesï¼Œç”¨æˆ·åœ¨ Preview ä¸­æŸ¥çœ‹
- æœ€ä½ç‰ˆæœ¬ iOS 17ï¼Œæ— å…¼å®¹é¡¾è™‘

**ä¸¤ç§å…¥å£**ï¼š

**Session Diff**ï¼šFiles Tab é¡¶éƒ¨æœ‰ä¸€ä¸ª segmented controlï¼Œåœ¨ "File Tree" å’Œ "Session Changes" ä¹‹é—´åˆ‡æ¢ã€‚é€‰æ‹© "Session Changes" æ—¶ï¼Œæ˜¾ç¤ºå½“å‰ session çš„æ‰€æœ‰æ–‡ä»¶å˜æ›´åˆ—è¡¨ï¼ˆ`GET /session/:id/diff`ï¼‰ï¼Œæ¯ä¸ªæ¡ç›®æ˜¾ç¤ºæ–‡ä»¶åå’Œ +N/-M ç»Ÿè®¡ã€‚ç‚¹å‡»è¿›å…¥ diff è¯¦æƒ…ã€‚

**å•æ–‡ä»¶ Diff**ï¼šåœ¨æ–‡ä»¶æ ‘ä¸­ç‚¹å‡»æœ‰å˜æ›´æ ‡è®°çš„æ–‡ä»¶æ—¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶æœ‰ uncommitted changesï¼Œå†…å®¹æŸ¥çœ‹é¡µé¢è‡ªåŠ¨åˆ‡æ¢åˆ° diff æ¨¡å¼ã€‚

Diff æ¸²æŸ“é‡‡ç”¨ unified diff æ ¼å¼ï¼ˆç±»ä¼¼ GitHubï¼‰ï¼Œç»¿è‰²èƒŒæ™¯è¡¨ç¤ºæ–°å¢è¡Œï¼Œçº¢è‰²èƒŒæ™¯è¡¨ç¤ºåˆ é™¤è¡Œã€‚æœåŠ¡ç«¯è¿”å›å®Œæ•´çš„ `before` å’Œ `after` å†…å®¹ï¼Œå®¢æˆ·ç«¯åš diff è®¡ç®—å’Œæ¸²æŸ“ã€‚è€ƒè™‘åˆ°æ‰‹æœºå±å¹•å®½åº¦ï¼Œé»˜è®¤åªæä¾› unified æ¨¡å¼ï¼Œä¸åš side-by-sideã€‚

### 4.4 Settings Tab

#### 4.4.1 Server Connection

- Server Addressï¼šæ–‡æœ¬è¾“å…¥æ¡†ï¼Œæ ¼å¼ `ip:port`ï¼Œé»˜è®¤ `192.168.180.128:4096`
- Usernameï¼šå¯é€‰ï¼Œé»˜è®¤ `opencode`
- Passwordï¼šå¯é€‰ï¼Œå­˜å…¥ Keychain
- è¿æ¥çŠ¶æ€æŒ‡ç¤ºï¼šæ˜¾ç¤º Connected / Disconnected / Connecting
- "Test Connection" æŒ‰é’®ï¼šè°ƒç”¨ `GET /global/health` éªŒè¯è¿æ¥

#### 4.4.2 Model Presets

ä¸€ä¸ªæœ‰åºåˆ—è¡¨ï¼Œæ¯æ¡è®°å½•åŒ…å«ï¼š
- æ˜¾ç¤ºåç§°ï¼ˆç”¨æˆ·è‡ªå®šä¹‰ï¼Œå¦‚ "Claude Opus"ï¼‰
- Provider IDï¼ˆå¦‚ `anthropic`ï¼‰
- Model IDï¼ˆå¦‚ `claude-opus-4-20250514`ï¼‰

æä¾›"ä»æœåŠ¡ç«¯å¯¼å…¥"åŠŸèƒ½ï¼šè°ƒç”¨ `GET /config/providers` è·å–æ‰€æœ‰å¯ç”¨çš„ Provider å’Œæ¨¡å‹åˆ—è¡¨ï¼Œç”¨æˆ·å‹¾é€‰æƒ³è¦çš„æ¨¡å‹åŠ å…¥é¢„è®¾åˆ—è¡¨ã€‚

åˆ—è¡¨æ”¯æŒæ‹–æ‹½æ’åºï¼Œæ’åœ¨å‰é¢çš„æ¨¡å‹åœ¨ Chat Tab çš„åˆ‡æ¢æ¡ä¸­æ›´é å·¦ã€‚

#### 4.4.3 Workspace

æ˜¾ç¤ºå½“å‰è¿æ¥çš„ OpenCode Server çš„é¡¹ç›®è·¯å¾„ï¼ˆæ¥è‡ª `GET /project/current`ï¼‰ã€‚å¦‚æœ Server ç®¡ç†äº†å¤šä¸ªé¡¹ç›®ï¼Œå¯ä»¥åˆ‡æ¢ï¼ˆæ¥è‡ª `GET /project`ï¼‰ã€‚

#### 4.4.4 å¤–è§‚

- ä»£ç å­—å·è°ƒèŠ‚ï¼ˆå°/ä¸­/å¤§ï¼‰
- **ä¸»é¢˜è·Ÿéšç³»ç»Ÿ**ï¼ˆLight/Dark/Autoï¼‰ï¼šæ ¹æ®ç³»ç»Ÿ theme åˆ‡æ¢æ˜æš—ä¸¤ç§æ ¼å¼
#### 4.4.5 About

- å½“å‰ App ç‰ˆæœ¬
- è¿æ¥çš„ OpenCode Server ç‰ˆæœ¬ï¼ˆæ¥è‡ª `GET /global/health` çš„ `version` å­—æ®µï¼‰

## 5. æ•°æ®æµä¸çŠ¶æ€ç®¡ç†

### 5.1 æ ¸å¿ƒçŠ¶æ€æ¨¡å‹

```swift
@Observable class AppState {
    // Connection
    var serverURL: String
    var isConnected: Bool
    var serverVersion: String?
    
    // Sessions
    var sessions: [Session]
    var currentSessionID: String?
    var sessionStatuses: [String: SessionStatus]  // sessionID â†’ status
    
    // Messages (for current session)
    var messages: [Message]          // ordered by time
    var parts: [String: [Part]]      // messageID â†’ parts
    
    // Models
    var modelPresets: [ModelPreset]   // user-configured
    var selectedModelIndex: Int
    
    // Files
    var fileStatuses: [FileStatus]   // git status
    var sessionDiffs: [FileDiff]     // current session's diffs
    
    // Permissions
    var recentPermissions: [PermissionLog]
}
```

### 5.2 SSE äº‹ä»¶å¤„ç†

æ”¶åˆ° SSE äº‹ä»¶åï¼ŒæŒ‰ `type` åˆ†å‘å¤„ç†ï¼š

| äº‹ä»¶ | å¤„ç†é€»è¾‘ |
|------|----------|
| `session.created` | è¿½åŠ åˆ° sessions åˆ—è¡¨ |
| `session.updated` | æ›´æ–°å¯¹åº” session çš„å±æ€§ |
| `session.status` | æ›´æ–° sessionStatuses å­—å…¸ |
| `session.diff` | æ›´æ–° sessionDiffs æ•°ç»„ |
| `message.updated` | æ›´æ–°æˆ–æ’å…¥ message |
| `message.part.updated` | æ›´æ–°å¯¹åº” partï¼›å¦‚æœæœ‰ deltaï¼Œè¿½åŠ åˆ° text part çš„æ–‡æœ¬æœ«å°¾ |
| `message.part.removed` | ä» parts ä¸­ç§»é™¤ |
| `permission.asked` | æ˜¾ç¤ºæƒé™è¯·æ±‚å¡ç‰‡ï¼Œç­‰å¾…ç”¨æˆ·æ‰‹åŠ¨æ‰¹å‡† |
| `file.edited` | è§¦å‘ file status åˆ·æ–° |
| `session.error` | æ˜¾ç¤ºé”™è¯¯ toast |

### 5.3 è¿æ¥æ¢å¤ç­–ç•¥

```
App è¿›å…¥å‰å°
  â”œâ”€â”€ è°ƒç”¨ GET /global/health ç¡®è®¤ server å­˜æ´»
  â”œâ”€â”€ è°ƒç”¨ GET /session æ‹‰å– session åˆ—è¡¨
  â”œâ”€â”€ è°ƒç”¨ GET /session/:id/message æ‹‰å–å½“å‰ session çš„å®Œæ•´æ¶ˆæ¯
  â”œâ”€â”€ è°ƒç”¨ GET /session/status æ‹‰å–æ‰€æœ‰ session çŠ¶æ€
  â””â”€â”€ å»ºç«‹ SSE è¿æ¥åˆ° GET /global/event
      â””â”€â”€ åç»­å¢é‡æ›´æ–°ç”± SSE é©±åŠ¨
```

è¿™ç§"å…¨é‡æ‹‰å– + å¢é‡è®¢é˜…"çš„æ¨¡å¼ä¿è¯äº†å³ä½¿ SSE åœ¨åå°æ–­å¼€ï¼Œä¹Ÿä¸ä¼šä¸¢å¤±çŠ¶æ€ã€‚

## 6. API ä¾èµ–æ¸…å•

ä»¥ä¸‹æ˜¯ iOS Client éœ€è¦è°ƒç”¨çš„ OpenCode API çš„å®Œæ•´åˆ—è¡¨ï¼š

### 6.1 å¿…éœ€ API

| æ–¹æ³• | è·¯å¾„ | ç”¨é€” |
|------|------|------|
| GET | `/global/health` | è¿æ¥æµ‹è¯•ã€è·å– server ç‰ˆæœ¬ |
| GET | `/global/event` | SSE äº‹ä»¶æµ |
| GET | `/session` | Session åˆ—è¡¨ |
| POST | `/session` | åˆ›å»º Session |
| GET | `/session/:id` | Session è¯¦æƒ… |
| DELETE | `/session/:id` | åˆ é™¤ Session |
| GET | `/session/:id/message` | æ¶ˆæ¯åˆ—è¡¨ |
| POST | `/session/:id/message` | å‘é€æ¶ˆæ¯ |
| POST | `/session/:id/prompt_async` | å¼‚æ­¥å‘é€æ¶ˆæ¯ |
| POST | `/session/:id/abort` | ä¸­æ­¢è¿è¡Œ |
| GET | `/session/:id/diff` | Session diff |
| GET | `/session/status` | æ‰€æœ‰ Session çŠ¶æ€ |
| POST | `/session/:id/permissions/:pid` | å“åº”æƒé™è¯·æ±‚ |
| GET | `/file?path=...` | æ–‡ä»¶åˆ—è¡¨ |
| GET | `/file/content?path=...` | æ–‡ä»¶å†…å®¹ |
| GET | `/file/status` | æ–‡ä»¶ git çŠ¶æ€ |
| GET | `/find/file?query=...` | æ–‡ä»¶æœç´¢ |
| GET | `/config/providers` | å¯ç”¨ Provider å’Œæ¨¡å‹åˆ—è¡¨ |
| GET | `/project` | é¡¹ç›®åˆ—è¡¨ |
| GET | `/project/current` | å½“å‰é¡¹ç›® |

### 6.2 å¯é€‰ APIï¼ˆåç»­å¢å¼ºï¼‰

| æ–¹æ³• | è·¯å¾„ | ç”¨é€” |
|------|------|------|
| POST | `/session/:id/summarize` | Compact session |
| POST | `/session/:id/fork` | Fork session |
| GET | `/session/:id/todo` | æŸ¥çœ‹ AI çš„ todo åˆ—è¡¨ |
| GET | `/find?pattern=...` | å…¨æ–‡æœç´¢ |
| GET | `/mcp` | MCP æœåŠ¡çŠ¶æ€ |
| GET | `/lsp` | LSP çŠ¶æ€ |
| PATCH | `/config` | ä¿®æ”¹é…ç½® |

## 7. UI çº¿æ¡†æè¿°

### 7.1 Chat Tab â€” iPhone

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜° Sessions    Session Title   â‹¯ â”‚  â† Navigation bar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Claude Opus] [Gemini 2.5] [G..â”‚  â† æ¨¡å‹åˆ‡æ¢æ¡ï¼ˆæ¨ªå‘æ»šåŠ¨ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Refactor the auth module  â”‚  â”‚  â† ç”¨æˆ·æ¶ˆæ¯
â”‚  â”‚              Claude Opus  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â–¸ Thinking... (æŠ˜å )      â”‚  â”‚  â† reasoning part
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚ I'll start by analyzing   â”‚  â”‚  â† text part (streaming)
â”‚  â”‚ the current auth flow...  â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ”§ read_file âœ“        â”‚ â”‚  â”‚  â† tool part
â”‚  â”‚ â”‚   src/auth/handler.ts â”‚ â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ”§ edit_file âŸ³        â”‚ â”‚  â”‚  â† tool running
â”‚  â”‚ â”‚   src/auth/handler.ts â”‚ â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚ âš ï¸ Permission required:   â”‚  â”‚  â† æƒé™è¯·æ±‚ï¼ˆéœ€æ‰‹åŠ¨æ‰¹å‡†ï¼‰
â”‚  â”‚   shell: npm test [Approve]â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ï¼‹ â”‚ Type a message...    â”‚ â¤  â”‚  â† è¾“å…¥æ¡†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Files Tab â€” iPhone

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Files                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [File Tree] [Session Changes]   â”‚  â† Segmented control
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Search files...              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¼ src/                          â”‚
â”‚   â–¼ auth/                       â”‚
â”‚     â— handler.ts        +12 -5  â”‚  â† modified (é»„ç‚¹)
â”‚     â—‹ types.ts                  â”‚
â”‚   â–¶ api/                        â”‚
â”‚   â–¶ utils/                      â”‚
â”‚ â–¼ tests/                        â”‚
â”‚   â— auth.test.ts        +45 -0  â”‚  â† new file (ç»¿ç‚¹)
â”‚ â—‹ package.json                  â”‚
â”‚ â—‹ tsconfig.json                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ç‚¹å‡»æ–‡ä»¶å push åˆ°æ–‡ä»¶è¯¦æƒ…é¡µï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â—€ Files   handler.ts   [Diff]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1 â”‚ import { Router } from ... â”‚
â”‚  2 â”‚ import { verify } from ... â”‚
â”‚  3 â”‚                            â”‚
â”‚  4+â”‚ export async function      â”‚  â† æ–°å¢è¡Œï¼ˆç»¿è‰²èƒŒæ™¯ï¼‰
â”‚  5+â”‚   authenticateUser(        â”‚
â”‚  6+â”‚   req: Request             â”‚
â”‚  7 â”‚ ) {                        â”‚
â”‚  8-â”‚   const token = req.head.. â”‚  â† åˆ é™¤è¡Œï¼ˆçº¢è‰²èƒŒæ™¯ï¼‰
â”‚  9+â”‚   const token = extractT.. â”‚  â† æ–°å¢è¡Œ
â”‚ 10 â”‚   ...                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 Settings Tab â€” iPhone

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Settings                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚ SERVER CONNECTION               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Address   192.168.180.128:4096 â”‚ â”‚
â”‚ â”‚ Username  opencode          â”‚ â”‚
â”‚ â”‚ Password  â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢          â”‚ â”‚
â”‚ â”‚ Status    ğŸŸ¢ Connected      â”‚ â”‚
â”‚ â”‚           [Test Connection] â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚ MODEL PRESETS                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â‰¡ Claude Opus 4             â”‚ â”‚
â”‚ â”‚ â‰¡ Gemini 2.5 Pro            â”‚ â”‚
â”‚ â”‚ â‰¡ GPT-4.1                   â”‚ â”‚
â”‚ â”‚       [+ Import from Server]â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚ WORKSPACE                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ~/projects/my-app           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚ APPEARANCE                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Code Font Size    [Medium â–¾]â”‚ â”‚
â”‚ â”‚ Theme             [Auto   â–¾]â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â”‚ ABOUT                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ App Version        0.1.0    â”‚ â”‚
â”‚ â”‚ Server Version     1.1.61   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 8. å¼€å‘åˆ†æœŸ

### Phase 1 â€” æœ€å°å¯ç”¨ç‰ˆæœ¬ï¼ˆMVPï¼‰

**ç›®æ ‡**ï¼šèƒ½è¿ä¸Š serverï¼Œå‘æ¶ˆæ¯ï¼Œçœ‹åˆ° AI çš„å®æ—¶å“åº”ã€‚

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| Server è¿æ¥ | æ‰‹åŠ¨è¾“å…¥ IP:Portï¼ŒBasic Auth |
| SSE äº‹ä»¶æµ | è¿æ¥ã€æ–­å¼€ã€é‡è¿ã€å‰åå°åˆ‡æ¢ |
| Session åŸºç¡€ | åˆ—è¡¨ã€åˆ›å»ºã€åˆ‡æ¢ã€åˆ é™¤ |
| æ¶ˆæ¯å‘é€ | æ–‡æœ¬è¾“å…¥ã€å‘é€ï¼ˆä½¿ç”¨ `prompt_async`ï¼‰ã€æŸ¥çœ‹å“åº”ï¼›busy æ—¶æ¶ˆæ¯è‡ªåŠ¨å…¥é˜Ÿ |
| æµå¼æ¸²æŸ“ | text part çš„å®æ—¶æ‰“å­—æœºæ•ˆæœ |
| æ¨¡å‹åˆ‡æ¢ | é¢„è®¾æ¨¡å‹åˆ—è¡¨ã€å‘é€æ—¶æŒ‡å®šæ¨¡å‹ |

**é¢„ä¼°å·¥ä½œé‡**ï¼š2-3 å‘¨ï¼ˆå‡è®¾å¯¹ SwiftUI æœ‰åŸºç¡€ç»éªŒï¼‰

### Phase 2 â€” å®Œæ•´äº¤äº’

**ç›®æ ‡**ï¼šèƒ½æœ‰æ•ˆåœ°ç›‘æ§ AI å·¥ä½œè¿‡ç¨‹å¹¶åšå®¡æŸ¥ã€‚

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| æ¶ˆæ¯ Part æ¸²æŸ“ | reasoningã€toolã€stepã€patch ç­‰æ‰€æœ‰ Part ç±»å‹ |
| æƒé™æ‰‹åŠ¨æ‰¹å‡† | ç›‘å¬ permission.askedï¼Œæ˜¾ç¤ºè¯·æ±‚å¡ç‰‡ï¼Œç”¨æˆ·æ‰‹åŠ¨æ‰¹å‡† |
| Abort / Compact | ä¸­æ­¢è¿è¡Œã€å‹ç¼© session |
| Markdown æ¸²æŸ“ | AI æ¶ˆæ¯ä¸­çš„ Markdown å®Œæ•´æ¸²æŸ“ |
| ä¸»é¢˜åˆ‡æ¢ | è·Ÿéšç³»ç»Ÿ Light/Dark |
| ä»£ç å—é«˜äº® | æ¶ˆæ¯ä¸­ä»£ç å—çš„è¯­æ³•é«˜äº® |
| **Sync Streaming** | delta å¢é‡æ›´æ–°ï¼ˆæ‰“å­—æœºæ•ˆæœï¼‰ã€Tool å®Œæˆåé»˜è®¤æ”¶èµ· |

**é¢„ä¼°å·¥ä½œé‡**ï¼š2 å‘¨

### Phase 3 â€” æ–‡ä»¶æµè§ˆä¸æ–‡æ¡£å®¡æŸ¥

**ç›®æ ‡**ï¼šå®Œæ•´çš„æ–‡ä»¶æµè§ˆå’Œ**æ–‡æ¡£å®¡æŸ¥**èƒ½åŠ›ï¼ˆæ–‡æ¡£ä¸ºä¸»ï¼Œä»£ç ä¸ºè¾…ï¼‰ã€‚

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| æ–‡ä»¶æ ‘ | ç›®å½•å±•å¼€/æ”¶èµ·ã€git çŠ¶æ€æ ‡è®° |
| æ–‡ä»¶å†…å®¹ | è¯­æ³•é«˜äº®ã€è¡Œå· |
| æ–‡ä»¶æœç´¢ | æ¨¡ç³Šæœç´¢æ–‡ä»¶å |
| Markdown é¢„è§ˆ | Preview æ¨¡å¼ä¸ºä¸»ï¼Œæ”¯æŒ Markdown/Preview åˆ‡æ¢ |
| æ–‡æ¡£ Diff | é«˜äº® changesï¼ˆä¼˜å…ˆ Preview å†…é«˜äº®ï¼Œå¦åˆ™ Markdown å†…é«˜äº®ï¼‰ |
| Session Diff | å½“å‰ session çš„å˜æ›´æ–‡ä»¶åˆ—è¡¨å’Œ diff è§†å›¾ |
| å•æ–‡ä»¶ Diff | æ–‡ä»¶çš„ uncommitted changes |

**é¢„ä¼°å·¥ä½œé‡**ï¼š2-3 å‘¨

### Phase 4 â€” æ‰“ç£¨ä¸å¢å¼ºï¼ˆæš‚ä¸å®ç°ï¼‰

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| iPad é€‚é… | Split viewã€sidebar ä¼˜åŒ– |
| mDNS è‡ªåŠ¨å‘ç° | å±€åŸŸç½‘è‡ªåŠ¨å‘ç° OpenCode server |
| æ¨é€é€šçŸ¥ | AI å®Œæˆä»»åŠ¡æ—¶é€šè¿‡ APNs é€šçŸ¥ï¼ˆéœ€è¦ server ç«¯é…åˆæˆ–è½®è¯¢ï¼‰ |
| Widget | iOS Widget æ˜¾ç¤ºå½“å‰ session çŠ¶æ€ |
| Haptic åé¦ˆ | å…³é”®æ“ä½œçš„è§¦è§‰åé¦ˆ |
| Spotlight é›†æˆ | æœç´¢æœ€è¿‘çš„ session |

## 9. å·²çŸ¥é™åˆ¶ä¸é£é™©

**ç½‘ç»œä¾èµ–**ï¼šApp å®Œå…¨ä¾èµ–ä¸ OpenCode Server çš„ç½‘ç»œè¿æ¥ã€‚å¦‚æœ Server ä¸å¯è¾¾ï¼ˆä¸åœ¨åŒä¸€ç½‘ç»œã€Server æœªå¯åŠ¨ï¼‰ï¼ŒApp æ— æ³•ä½¿ç”¨ã€‚åˆæœŸåªæ”¯æŒå±€åŸŸç½‘ç›´è¿ï¼Œåç»­å¯ä»¥é€šè¿‡ Tailscale/Cloudflare Tunnel ç­‰æ–¹æ¡ˆæ‰©å±•åˆ°è¿œç¨‹è®¿é—®ã€‚

**SSE åœ¨ iOS ä¸Šçš„è¡Œä¸º**ï¼šiOS ä¼šåœ¨ App è¿›å…¥åå°åç§¯ææ–­å¼€ç½‘ç»œè¿æ¥ã€‚éœ€è¦å®ç°å¯é çš„é‡è¿å’ŒçŠ¶æ€æ¢å¤æœºåˆ¶ã€‚ä¸å»ºè®®åœ¨åå°ä¿æŒ SSE è¿æ¥ã€‚

**å±å¹•å°ºå¯¸**ï¼šä»£ç å’Œ diff åœ¨ iPhone çª„å±ä¸Šçš„å¯è¯»æ€§æ˜¯ä¸€ä¸ªæŒç»­æŒ‘æˆ˜ã€‚éœ€è¦ä»”ç»†è®¾è®¡æ¨ªå‘æ»šåŠ¨ã€å­—å·è°ƒèŠ‚ç­‰äº¤äº’ã€‚iPad ä¸Šçš„ä½“éªŒä¼šæ˜¾è‘—æ›´å¥½ã€‚

**Server API ç¨³å®šæ€§**ï¼šOpenCode çš„ HTTP API ç›®å‰æ²¡æœ‰æ­£å¼çš„ç‰ˆæœ¬æ‰¿è¯ºï¼ˆæ²¡æœ‰ `/v1/` å‰ç¼€ï¼‰ã€‚Server æ›´æ–°å¯èƒ½å¼•å…¥ breaking changesã€‚å»ºè®® iOS ç«¯å¯¹ API å“åº”åšé˜²å¾¡æ€§è§£æï¼Œå¯¹æœªçŸ¥å­—æ®µå¿½ç•¥è€Œé crashã€‚

**å®‰å…¨**ï¼šåˆæœŸ App ä»…ç”¨äºæœ¬åœ°å±€åŸŸç½‘ï¼Œå®‰å…¨é£é™©è¾ƒä½ã€‚å¦‚æœåç»­æ”¯æŒå…¬ç½‘è®¿é—®ï¼Œéœ€è¦è€ƒè™‘ TLSã€token-based auth ç­‰å¢å¼ºæ–¹æ¡ˆã€‚å½“å‰çš„ Basic Auth over HTTP åœ¨å±€åŸŸç½‘ç¯å¢ƒä¸‹å¯æ¥å—ï¼Œä½†ä¸é€‚åˆå…¬ç½‘æš´éœ²ã€‚

## 10. å·²å†³äº‹é¡¹

1. **æ¶ˆæ¯å‘é€ API**ï¼šä½¿ç”¨ `POST /session/:id/prompt_async`ã€‚æºç è°ƒç ”ç¡®è®¤ï¼šsync ä¸ async å‡è°ƒç”¨åŒä¸€ `SessionPrompt.prompt()`ï¼Œasync ä»…ä¸ await å“åº”ï¼›æ¶ˆæ¯åˆ›å»ºã€å¤„ç†ã€SSE æ¨é€è¡Œä¸ºå®Œå…¨ä¸€è‡´ã€‚iOS ç«¯é…åˆ SSE è·å–ç»“æœï¼Œasync æ›´åˆé€‚ã€‚

2. **å¤§å‹ Session**ï¼šæš‚ä¸è€ƒè™‘ã€‚ä¸é¢„æœŸ session è¶…è¿‡ç™¾æ¡æ¶ˆæ¯ã€‚

3. **æ¨é€é€šçŸ¥**ï¼šæš‚ä¸å®ç°ã€‚

4. **å¤šé¡¹ç›®æ”¯æŒ**ï¼šæš‚ä¸å®ç°ã€‚

5. **é»˜è®¤ Server**ï¼š`192.168.180.128:4096`ã€‚é»˜è®¤æ— è®¤è¯ï¼Œä½†éœ€å®ç° Basic Auth æ”¯æŒï¼ˆå¯é€‰é…ç½®ï¼‰ã€‚

## 11. å®ç°èµ·æ­¥æŒ‡å—

### 11.1 é¡¹ç›®åˆ›å»º

**æ¨èæ–¹å¼**ï¼šä½¿ç”¨ Xcode æ–°å»ºå·¥ç¨‹

1. æ‰“å¼€ Xcodeï¼Œé€‰æ‹© **File â†’ New â†’ Project**
2. é€‰æ‹© **App** æ¨¡æ¿ï¼ˆiOSï¼‰
3. é…ç½®ï¼š
   - Product Name: `OpenCode`
   - Team: é€‰æ‹©ä½ çš„å¼€å‘è€…è´¦å·
   - Organization Identifier: å¦‚ `com.yourname`
   - Interface: **SwiftUI**
   - Language: **Swift**
   - å‹¾é€‰ **Include Tests**
4. æœ€ä½éƒ¨ç½²ç‰ˆæœ¬è®¾ä¸º **iOS 17.0**
5. å­˜å‚¨ä½ç½®é€‰åœ¨åˆé€‚çš„ç›®å½•

### 11.2 ä¾èµ–ä¸ç»“æ„

- **ç½‘ç»œå±‚**ï¼šä½¿ç”¨ `URLSession` åŸç”Ÿå®ç° REST + SSEï¼Œæ— éœ€å¼•å…¥ Alamofire ç­‰ç¬¬ä¸‰æ–¹åº“
- **çŠ¶æ€ç®¡ç†**ï¼š`@Observable`ï¼ˆiOS 17+ï¼‰é…åˆ SwiftUI
- **Markdown**ï¼šå¯é€‰ç”¨ [MarkdownUI](https://github.com/gonzalezreal/MarkdownUI) æˆ–è‡ªå»º `AttributedString` è§£æ
- **ä¸»é¢˜**ï¼šé€šè¿‡ `@Environment(\.colorScheme)` è·Ÿéšç³»ç»Ÿ

### 11.3 å»ºè®®çš„å®ç°é¡ºåº

1. **Phase 1**ï¼šServer è¿æ¥ã€SSEã€Sessionã€æ¶ˆæ¯å‘é€ä¸æµå¼æ¸²æŸ“
2. **Phase 2**ï¼šæ¶ˆæ¯ Part æ¸²æŸ“ã€æƒé™æ‰‹åŠ¨æ‰¹å‡†ã€ä¸»é¢˜åˆ‡æ¢ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆè°ƒç”¨ `prompt_async`ï¼‰
3. **Phase 3**ï¼šæ–‡ä»¶æ ‘ã€Markdown é¢„è§ˆã€æ–‡æ¡£ Diffã€é«˜äº® changes

### 11.4 ä¸ OpenCode Server çš„å¯¹æ¥

é»˜è®¤ Server åœ°å€ï¼š`192.168.180.128:4096`ï¼ˆæ— è®¤è¯ï¼‰ã€‚è‹¥ Server å¯ç”¨äº† `OPENCODE_SERVER_PASSWORD` ç­‰ï¼Œåœ¨ Settings ä¸­é…ç½® Username/Password å³å¯ã€‚ç¡®ä¿æœ¬æœºæˆ–å±€åŸŸç½‘å†…æœ‰è¿è¡Œä¸­çš„ OpenCode Serverï¼ˆ`opencode serve` æˆ– `opencode web`ï¼‰ã€‚

---

## é™„å½• A â€” OpenCode Server å…³é”®æ•°æ®ç»“æ„å‚è€ƒ

### Session

```typescript
{
  id: string
  slug: string
  projectID: string
  directory: string
  parentID?: string
  title: string
  version: string
  time: { created: number, updated: number }
  share?: { url: string }
  summary?: { additions: number, deletions: number, files: number }
}
```

### Message (User)

```typescript
{
  id: string, sessionID: string, role: "user",
  model: { providerID: string, modelID: string },
  time: { created: number }
}
```

### Message (Assistant)

```typescript
{
  id: string, sessionID: string, role: "assistant",
  parentID: string,  // links to user message
  providerID: string, modelID: string,
  cost: number,
  tokens: { input: number, output: number, reasoning: number, cache: { read: number, write: number } },
  time: { created: number, completed?: number }
}
```

### Part (æ ¸å¿ƒç±»å‹)

```typescript
// Text
{ id, type: "text", text: string }

// Reasoning
{ id, type: "reasoning", text: string }

// Tool call
{ id, type: "tool", callID: string, tool: string, state: "pending"|"running"|"completed"|"error", metadata?: any }

// Step markers
{ id, type: "step-start", snapshot?: string }
{ id, type: "step-finish", reason: string, cost: number, tokens: {...} }

// File change
{ id, type: "patch", hash: string, files: [...] }
```

### FileDiff

```typescript
{
  file: string,       // relative path
  before: string,     // full content before
  after: string,      // full content after
  additions: number,
  deletions: number,
  status?: "added" | "deleted" | "modified"
}
```

### SSE Event

```typescript
{
  directory: string,  // project path, or "global"
  payload: {
    type: string,     // e.g. "message.part.updated"
    properties: any   // event-specific data
  }
}
```
