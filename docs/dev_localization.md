# Localization 调研与规划（iOS Client）

最后更新：2026-02-15

## 背景

当前应用是中英文混用状态：核心导航（Chat/Files/Settings）偏英文，但大量按钮、提示、错误文案仍是中文硬编码。你提到的 Settings sheet 里的“关闭”就是这个混用问题的典型表现。

本文件目标不是立刻全量改造，而是给出一条可执行、低风险、可迭代的本地化路径。

## 现状结论

- UI 文案目前主要是 SwiftUI `Text("...")` / `Button("...")` 直接硬编码。
- 项目里尚未建立 `Localizable.strings` / `String Catalog (.xcstrings)` 体系。
- 没有统一 i18n 包装层（例如 `L10n.xxx`），所以文案难做一致性检查。
- 结果是：英文系统下会出现中文按钮，中文系统下也会出现英文提示。

## 复杂度评估

如果目标是“英文系统显示英文、中文系统显示中文”，技术上不难，属于中等规模治理任务，主要工作量在文案梳理和批量替换，不在底层架构。

- **快速可用版（1-2 天）**：优先覆盖高频入口（Settings、Chat 主流程、错误弹窗），可显著降低混用感。
- **完整稳定版（3-6 天）**：覆盖全 UI + 错误文案 + 单元/UI 回归，形成持续可维护的本地化机制。

## 推荐实施方案

1. 建立 i18n 基础设施
   - 使用 Xcode String Catalog（推荐）或 `Localizable.strings`。
   - 至少创建 `en`、`zh-Hans` 两套资源。
   - 统一 key 命名，如 `settings.close`, `ssh.status.connected`。

2. 引入轻量访问层
   - 新增 `L10n` 工具（enum/struct），让视图层尽量不直接写裸字符串 key。
   - 统一参数化文案格式，减少字符串拼接。

3. 分批迁移
   - P1：Settings 与连接链路（用户最敏感路径）。
   - P2：Chat、Session、Files。
   - P3：错误文案、调试提示、边角页。

4. 验证与回归
   - iOS Scheme 分别切换 English / Chinese 运行。
   - 对关键页面做 UI snapshot 或最小 smoke test，避免回归混用。

## 本次建议（短平快）

先做一轮 UX 修补：把 Settings sheet 的“关闭”改成右上角 `Close`，保证当前英文主界面不被中文单点打断。再按上面的分批计划推进全量本地化。

## 风险与注意事项

- 不能只翻译静态文案：错误信息里常有服务端返回文本，需定义“原样透传 vs 本地模板”策略。
- 文案 key 需要冻结命名规范，否则后续多人协作会很快失控。
- 本地化推进时建议顺手清理历史硬编码，避免旧字符串反复回流。
